<!-- -*- mode: HTML; tab-width: 2; indent-tabs-mode: nil; -*- -->
<!-- vim: set tabstop=2 expandtab shiftwidth=2 textwidth=80:  -->
<!DOCTYPE html>
<html class="reftest-wait">
  <head>
    <title>Reprocess</title>
    <!-- Copyright (c) 2011 Design Science, Inc.
         License: Apache License 2.0 -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" src="../../header.js"></script>
    <script type="text/javascript" src="../../scriptTests.js"></script>

    <script type="text/javascript">
      var r1 = false, r2 = false, r3 = false, r4 = false, r5 = false;
      
      function f()
      {
        r1 = true;
        var mspace = document.getElementById("mspace");
        r4 = (mspace.offsetHeight == 100);
        r5 = (mspace.offsetWidth == 100);
      }

      function postMathJax() 
      {
      var math = MathJax.Hub.getAllJax("div")[0];
      document.getElementById("div").style.fontSize = "24pt" 
      var mspace = document.getElementById("mspace");
      r2 = (mspace.offsetHeight == 200);
      r3 = (mspace.offsetWidth == 200);

      MathJax.Hub.Queue(["Reprocess", MathJax.Hub, "div", f]);
      }

      function getTestCases()
      {
      return [
      newScriptReftestResult("Reprocess(div, f): Callback is called", r1),
      newScriptReftestResult("After style change: mspace.offsetHeight == 200",
                             r2),
      newScriptReftestResult("After style change: mspace.offsetWidth == 200",
                             r3),
      newScriptReftestResult("After reprocess: mspace.offsetHeight == 100", r4),
      newScriptReftestResult("After reprocess:  mspace.offsetWidth == 100", r5)
      ];
      }
    </script>

  </head>

  <body style="font-size: 12pt;">

    <!-- It is assumed that MathJax converts this absolute dimensions into 
         relative ones. When the font-size is updated, the square becomes
         twice larger, so we need to reprocess the math -->
    <div id="div">
      <math>
        <mspace id="mspace" width="100px" height="100px" mathbackground="blue"></mspace>
      </math>
    </div>

  </body>
</html>
