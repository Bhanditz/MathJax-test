<!-- -*- mode: HTML; tab-width: 2; indent-tabs-mode: nil; -*- -->
<!-- vim: set tabstop=2 expandtab shiftwidth=2 textwidth=80:  -->
<!DOCTYPE html>
<html class="reftest-wait">
  <head>
    <title>Reprocess</title>
    <!-- Copyright (c) 2011 Design Science, Inc.
         License: Apache License 2.0 -->
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <script type="text/javascript" src="../../header.js"></script>
    <script type="text/javascript" src="../../scriptTests.js"></script>

    <script type="text/javascript">
    
      var r1 = false, r2 = false, r3 = false, r4 = false, r5 = false,
          r6 = false, r7 = false, r8 = false;

      function f()
      {
        r1 = true;
        var mspace1 = document.getElementById("mspace1");
        r6 = (mspace1.offsetWidth == 100);
      }

      function g()
      {
        r2 = true;
        var mspace2 = document.getElementById("mspace2");
        r7 = (mspace2.offsetWidth == 100);
      }

      function postMathJax() 
      {
      var math = MathJax.Hub.getAllJax("div")[0];
      document.body.style.fontSize = "24pt";
      var mspace1 = document.getElementById("mspace1");
      var mspace2 = document.getElementById("mspace2");
      var mspace3 = document.getElementById("mspace3");
      r3 = (mspace1.offsetWidth == 200);
      r4 = (mspace2.offsetWidth == 200);
      r5 = (mspace3.offsetWidth == 200);
      MathJax.Hub.Queue(["Reprocess", MathJax.Hub, "div1", f]);
      MathJax.Hub.Queue(["Reprocess", MathJax.Hub, "div2", g]);
      }

      function getTestCases()
      {
      var mspace3 = document.getElementById("mspace3");
      r8 = (mspace3.offsetWidth == 200);

      return [
        newScriptReftestResult("Callback f called", r1),
        newScriptReftestResult("Callback g called", r2),
        newScriptReftestResult("mspace1, before reprocess", r3),
        newScriptReftestResult("mspace2, before reprocess", r4),
        newScriptReftestResult("mspace3, before reprocess", r5),
        newScriptReftestResult("mspace1, after reprocess", r6),
        newScriptReftestResult("mspace2, after reprocess", r7),
        newScriptReftestResult("mspace3, at the end", r8)
      ];
      }
    </script>

  </head>

  <body style="font-size: 12pt;">

    <!-- It is assumed that MathJax converts this absolute dimensions into 
         relative ones. When the font-size is updated, the square becomes
         twice wider, so we need to reprocess the math -->
    <div id="div1" style="position: absolute; top: 0px;">
      <math>
        <mspace id="mspace1" width="100px" height="10px" mathbackground="blue">
        </mspace>
      </math>
    </div>

    <div id="div2" style="position: absolute; top: 30px;">
      <math>
        <mspace id="mspace2" width="100px" height="10px" mathbackground="red">
        </mspace>
      </math>
    </div>

    <div id="div3" style="position: absolute; top: 60px;">
      <math>
        <mspace id="mspace3" width="100px" height="10px" mathbackground="green">
        </mspace>
      </math>
    </div>

    <div style="height: 100px"></div>

  </body>
</html>
