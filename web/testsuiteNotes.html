<!-- -*- Mode: HTML; tab-width: 2; indent-tabs-mode:nil; -*- -->
<!-- vim: set ts=2 et sw=2 tw=80: !-->
<!DOCTYPE html>
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Testsuite Notes</title>
    <!-- Copyright (c) 2011 Design Science, Inc.
         License: Apache License 2.0 -->
    <link rel="stylesheet" type="text/css" href="default.css"/>
  </head>

  <body>

    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li><a href="./">Back to home</a></li> 
      </ul>
    </div>

    <div class="body testsuiteNotes">
      <h1>Testsuite Notes</h1>

      <div>
        <code>Configuration/HTML-CSS/minScaleAdjust-1.html</code>
        <p>This test is probably not correct. Davide said:</p>
        <blockquote>
          <p>The minScaleAdjust test does not work as desired because the the minScaleAdjust value is not a percentage of what it would have been without it, but is an absolute percentage used for the font-size CSS parameter.That is, when you set minScaleAdjust to 300, that forces the font-size to be 300.The problem is that the font-size that would have been used without minScaleAdjust is not 100, since the font-size is determined by trying to match the ex-height of the math font to the surrounding font.So that may be something like 132% rather than 100%.Your test doesn't take that 132% factor into account.</p>
          <p>I would suggest a different approach:Use something like <span style="font-size:10%">...</span> around the math and see how it compares to <span style="font-size:50%">...</span>.The default setting for minScaleAdjust should make the math be the same size.Alternatively, you can set minScaleAdjust to 10 in the test case and use font-size:10% in both test and reference, and see if the results are DIFFERENT (since the minScaleAdjust in the reference will still be 50%)</p>
        </blockquote>
        <p>I tried both the Davide proposals, but was not able to make them work.</p>
      </div>

      <div>
        <code>Configuration/HTML-CSS/scale-1</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mfrac/*</code>
        <p>Rounding issues.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/CSS/mfenced-04</code><br/>
        <code>MathMLToDisplay/Presentation/CSS/mfenced-05</code><br/>
        <code>MathMLToDisplay/Presentation/CSS/mfenced-06</code><br/>
        <code>MathMLToDisplay/Presentation/CSS/mprescripts/*</code><br/>
        <code>MathMLToDisplay/Presentation/CSS/mtable/*</code>
        <p>The author of these tests says "Right hand side of equation should look like mirrored copy of left hand side". To convert these tests into reftest, the experimental CSS "transform" property has been used. However, the tests and references do not seem to match exactly.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/CSS/mfrac/mfrac-11</code><br/>
        <code>MathMLToDisplay/Presentation/CSS/mfrac/mfrac-12</code>
        <p>These two tests are taken from the W3C MathML testsuite, and were already more or less "reftests". They use &lt;mspace linebreak="newline"/&gt;'s and &lt;mphantom/&gt;'s. I'm not quite sure they are correct.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Characters/Variants/*</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mi/miequivalents11</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mi/mimathvariant13</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mi/mimathvariant14</code>
        <p>These tests are taken from the W3C MathML testsuite. I've tried to convert them by comparing the combination of mathvariant on a mi (for example double struck A) and the direct use of a unicode point for this styled character (for example U+1D538). It turns out that this is not perfect, the result depending on fonts installed, how browsers pick the glyph etc.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-1</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-2</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-3</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-4</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-5</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mozilla/mpadded-1-2</code>
        <p>mpadded-4: In voffset, the default value for lspace is zero. The test below use the invalid syntax <code>lspace="3lspace"</code> (lspace can not be used as a pseudo-unit) so I would expect the default value to be used. It seems that MathJax allows lspace to be used as a pseudo-unit</p>
        <p>To analyse further...</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mpadded-3</code>
        <p>The mpadded bars are too thick (the thickness should only be 1px). Note that the mspace version of this test (MathMLToDisplay/Presentation/TokenElements/mspace/mspace-3) works.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TokenElements/mo/mo1</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mo/moAform11</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mo/moAlrspace13</code>
        <p>For <code>mo1</code>, the prefix form of <code>'MINUS SIGN' (U+2212)</code> should have a <code>veryverythinmathspace</code> after it per the MathML3 Operator dictionary. Similarly, in <code>moAform11</code> and <code>moAlrspace13</code> the spaces around the operators should be determined according to the <code>lspace/rspace</code> attributes and the operator form.</p>
      </div>

      <div>
        <code>API/Message/Set-1.html</code>
        <p>Bug in MathJax.Message.Clear when delay = 0??</p>
      </div>

      <div>
        <code>MathMLToDisplay/Characters/entities-1</code><br/>
        <code>MathMLToDisplay/Characters/entities-2</code><br/>
        <code>MathMLToDisplay/Characters/entities-3</code><br/>
        <code>MathMLToDisplay/Characters/entities-4</code><br/>
        <code>MathMLToDisplay/Characters/entities-5</code>
        <p>Many browsers do not convert correctly entity names.</p>
        <ul>
          <li>Opera: <code>&amp;lang;</code> and <code>&amp;rang;</code> are not mapped to the right unicode characters. Bug report ID is DSK-343994 (not publicly available).</li>
          <li>Safari/Chrome: <code>&amp;notinE;</code> and <code>&amp;notindot;</code> are not supported. See <a href="https://bugs.webkit.org/show_bug.cgi?id=62187">bug 62187</a>. See also <a href="https://bugs.webkit.org/show_bug.cgi?id=43949#c39">bug 43949</a>. Not tested with Konqueror yet.</li>
          <li>Internet Explorer: Entity definitions for characters are not up-to-date. See <a href="https://connect.microsoft.com/IE/feedback/details/674766/">feedback 674766</a>.</li>
        </ul>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mpadded-2a</code><br/>
        <code>MathMLToDisplay/Presentation/GeneralLayout/mpadded/mpadded-2b</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mspace/mspace-2a</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mspace/mspace-2b</code>
        <p>Davide said:</p>
        <blockquote>
          <p>There are a couple of problems here.The first is that the IE box model works differently than the other browsers (i.e., is broken).Your test creates a math element with height 100px (or depth 100px) and compares that to a div of size 100px.The problem is that in IE, the math of height 100px is part of a line of text, and that line also has depth, so the height of the div containing the math is larger than 100px.In this case, the math element sits on top of the baseline, and has 100px above the baseline, and has the depth of the line containing the math, so the height is 100px plus the depth of the line.Similarly for the second test with depth 100px, the div containing it will be 100px plus the height of the line.</p>
          <p>One way to adjust the test would be to make the reference be a div containing an element that sites on the baseline and has height 100px.The only reliable way I know to do that is to use an image of height 100px (make it have visibility:hidden).To make one below the baseline, use an image of height 100px with vertical-align:-100px (so that means two different reference files).</p>
          <p>This gets you closer, but there is still a problem:it turns out that IE's broken box model causes some boxes that should be of height 0 (by explicit CSS settings) to be of height and depth that of the line they contain, and this is happening even in the simple test case you have.I haven't been able to track down exactly where this is coming from (the IE8 developer tools are completely unreliable, so it is difficult to debug), but it looks like the math gets the height and depth of the MathJax fonts, which is larger than the surrounding font (in particular the depth), and so even the image trick that I suggest will be off by a few pixels.I'll look into it further, but not for this release.</p>
          <p>Yes, this is the problem I mentioned before:the div containing the math has depth or height that is not part of the math, andso doesn't match the size of the div in the reference file. I suggested a possible alternative in my previous message.(It turns out that only part of this is an IE box problem -- the main issue is the extra height or depth, which is true for ALL browsers.)</p>
        </blockquote>
        <p>I have not tried to modify these test pages yet. They are currently using the HTML5 doctype and so are broken on all browsers.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TablesAndMatrices/mtable/rowalign-1</code><br/>
        <code>MathMLToDisplay/Presentation/TablesAndMatrices/mtable/rowalign-3</code><br/>
        <code>MathMLToDisplay/Presentation/TablesAndMatrices/mtable/rowalign-4</code>
        <p>The rowalign attribute seems to work correctly, but in the reference pages, Some &lt;mspace&gt;'s with mathbackground="white" are not drawn over its predecessor mpadded element. Marked "fails". </p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TablesAndMatrices/mtr-mtd/columnspan-1</code><br/>
        <code>MathMLToDisplay/Presentation/TablesAndMatrices/mtr-mtd/rowspan-1</code>
        <p>columnspan and rowspan do not seem to be implemented.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TokenElements/mi/miAtoken5</code>
        <p>Test taken from the MathML testsuite. One "A" uses mathvariant="script" and the obsolete fontweight="bold". It seems to me that only the mathvariant="script" style should be applied here, and so the A should not be bold... Examples were given in MathML2 but I can't find them in MathML3.</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TokenElements/mspace/mspace2</code><br/>
        <code>MathMLToDisplay/Presentation/TokenElements/mtext/mtext1</code>
        <p>There is a color difference for some pixels, invisible at the naked eye..</p>
      </div>

      <div>
        <code>MathMLToDisplay/Presentation/TokenElements/mtext/mtextspaces7</code>
        <p>To analyse further...</p>
      </div>


      <div>
        <code>MathMLToDisplay/Presentation/ScriptsAndLimits/munderover/munderover-empty-scripts</code>
        <p>This test compares the rendering of mrow/munder/mover and the corresponding constructs with munderover and empty scripts (mspaces of size 0). Davide said:</p>
        <blockquote>
          I've checked into this, and I think the MathJax rendering is correct.  The layout algorithm for munder (et al.) follows TeX's method, which tries to put the baseline of the underscript at a fixed position relative to the base, when possible (so underscripts of adjacent terms will line up regardless of ascenders, for example).  So your &lt;mspace&gt; is typeset at the normal baseline for an underscript, which is what gives it the extra depth.  The overscripts are also at the normal baselines for overscripts, but the &lt;mspace&gt; has no height, so there is no extra space above the baseline. 
        </blockquote>
      </div>

      <div>
        <code>MathMLToDisplay/Topics/WhiteSpace/white*</code>
        <p>To analyse further...</p>
      </div>

    </div>
  </body>
</html>


